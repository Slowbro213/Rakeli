var m=document.getElementById("terminal-input"),S=document.getElementById("terminal-input-row"),x=document.getElementById("autocomplete"),d=document.getElementById("terminal-body"),a=document.getElementById("terminal-window");var v=!1,C=!1,H=0,D=0,J=(t)=>{if("touches"in t)return{clientX:t.touches[0]?.clientX,clientY:t.touches[0]?.clientY};else return{clientX:t.clientX,clientY:t.clientY}};a.addEventListener("mousedown",(t)=>{m.focus();let e=a.getBoundingClientRect(),o=20;if(t.clientX>e.right-o&&t.clientY>e.bottom-o)C=!0});a.onmousedown=(t)=>{if(C)return;I(t)};a.ontouchstart=(t)=>{if(t.preventDefault(),C)return;I(t)};function I(t){let{clientX:e,clientY:o}=J(t);if(!e||!o)return;v=!0;let r=a.getBoundingClientRect();H=e-r.left,D=o-r.top,a.style.cursor="grabbing",a.style.userSelect="none",document.body.style.userSelect="none"}document.addEventListener("mousemove",(t)=>{if(C)return;if(!v)return;let e=t.clientX-H,o=t.clientY-D;a.style.left=`${e}px`,a.style.top=`${o}px`});document.addEventListener("touchmove",(t)=>{if(t.preventDefault(),C)return;if(!v)return;let e=t.touches[0];if(!e)return;let o=e.clientX-H,r=e.clientY-D;a.style.left=`${o}px`,a.style.top=`${r}px`},{passive:!1});document.addEventListener("mouseup",()=>{v=!1,C=!1,a.style.cursor="",a.style.userSelect="",document.body.style.userSelect=""});document.addEventListener("touchend",()=>{v=!1,C=!1,a.style.cursor="",a.style.userSelect="",document.body.style.userSelect=""});var l=(t)=>{let e=Array.isArray(t)?t:[t];for(let o of e){let r=document.createElement("p");r.className="terminal-line",r.textContent=`${o}`,d.appendChild(r)}};var R={name:"help",exec:()=>{return l(["help","ls","cd ( doesnt work yet )","slowking","echo","clear","history"]),0}};var X={name:"slowking",exec:()=>{return l("Thats Me!"),0}};var w=new Map([["PATH","/aswsome/binaries"],["HOME","/Rakeli/Home"],["WORKING_DIR","/Rakeli/Home"],["EXIT_CODE",0]]);var N={name:"echo",exec:(t)=>{if(!t||t.length<2)return 1;let e=t.slice(1).join(" "),o=t[1];switch(o){case"$?":{let r=w.get("EXIT_CODE");return l(String(r)),0}default:if(o?.startsWith("$")){let r=o.slice(1),n=w.get(r);if(n!==void 0)return l(String(n)),0;else return l(`No such variable: ${r}`),1}}return l(e),0}};var B={name:"ls",exec:()=>{return l(["Pages on this Website:","About_Me","Writeups","Projects","Home"]),0}};var Y={name:"cd",exec:()=>{return 0}};var k={name:"clear",exec:(t)=>{if(!d||!t)return 0;let e=2,o=e+1+(t[0]==="clear"?1:0);while(d.children.length>o){let r=d.children[e];if(!r)break;d?.removeChild(r)}return 0}};var y=[],g=0,Z=100,O=(t)=>{if(y[y.length-1]===t)return;if(y.length===Z)y.shift();y.push(t),g=y.length},W=()=>{if(g--,g<0)g=0;return y[g]},_=()=>{if(g++,g>y.length){g--;return}return y[g]},$=()=>{return y};var P={name:"history",exec:()=>{return l($()),0}};var A=[X,N,B,Y,k,R,P];var Q=(t)=>{console.log("Building Commands...");let e={children:new Map};for(let o of t){let r=e;for(let n of o.name){if(!r.children.has(n))r.children.set(n,{children:new Map});r=r.children.get(n)}r.command=o}return e},z=(t)=>{if(!t||L===null)return[];let e=L;for(let n of t){let i=e.children.get(n);if(!i)return[];e=i}function o(n){if(n.command?.name.startsWith(t))return n.command.name;if(n.line?.startsWith(t))return n.line;for(let i of n.children.values()){let p=o(i);if(p)return p}return}let r=o(e);return r?[r]:[]},K=(t)=>{if(!t||L===null)return;let e=L;for(let o of t){let r=e.children.get(o);if(!r)return;e=r}return e.command?.name===t?e.command:void 0},V=(t,e=L)=>{let o=e;for(let r of t){if(!o.children.has(r))o.children.set(r,{children:new Map});o=o.children.get(r)}o.line=t},L=Q(A);var T=()=>{d.removeChild(S),d.appendChild(S),m.focus()};var j=(t,e)=>{if(t===e)return 0;let o=t.length,r=e.length;if(o===0||r===0)return o+r;let n=0,i,p,u,c,s,f,h,E,b=new Array(o);for(i=0;i<o;)b[i]=++i;for(;n+3<r;n+=4){let M=e.charCodeAt(n),U=e.charCodeAt(n+1),q=e.charCodeAt(n+2),F=e.charCodeAt(n+3);c=n,u=n+1,s=n+2,f=n+3,h=n+4;for(i=0;i<o;i++){if(E=t.charCodeAt(i),p=b[i],p<c||u<c)c=p>u?u+1:p+1;else if(M!==E)c++;if(c<u||s<u)u=c>s?s+1:c+1;else if(U!==E)u++;if(u<s||f<s)s=u>f?f+1:u+1;else if(q!==E)s++;if(s<f||h<f)f=s>h?h+1:s+1;else if(F!==E)f++;b[i]=h=f,f=s,s=u,u=c,c=p}}for(;n<r;){let M=e.charCodeAt(n);c=n,s=++n;for(i=0;i<o;i++){if(p=b[i],p<c||s<c)s=p>s?s+1:p+1;else if(M!==t.charCodeAt(i))s=c+1;else s=c;b[i]=s,c=p}h=s}return h};var G=(t)=>{let e={};return A.forEach((o)=>{let r=j(t,o.name);if(!e.name||!e.distance||e.distance>r)e.name=o.name,e.distance=r;return}),e.name};m.addEventListener("keydown",(t)=>{if(t.ctrlKey&&t.key.toLowerCase()==="l"){t.preventDefault(),k.exec(["shortcut"]);return}switch(t.key){case"Enter":{let e=m.value,o=e.split(" ");if(!e||!o||!o[0]){l("No detectable input ;-;"),T(),m.value="";break}let r=K(o[0]);if(l("> "+e),O(e),V(e),!r){let n=G(o[0]);if(!n)l("Command doesn't exist :(");else l(["Command doesn't exist, did you mean:",n]);T(),m.value="";break}w.set("EXIT_CODE",r.exec(o)),T(),m.value="";break}case"ArrowRight":{let e=x.textContent?.trim();if(e&&e.startsWith(m.value))m.value=e,x.innerHTML="";break}case"ArrowUp":{t.preventDefault();let e=W();if(x.innerHTML="",!e)break;m.value=e,m.setSelectionRange(e.length,e.length);break}case"ArrowDown":{let e=_();if(x.innerHTML="",!e){m.value="";break}m.value=e,m.setSelectionRange(e.length,e.length);break}default:{let e=m.value+t.key,o=z(e);if(o.length===0||!o[0]){x.innerHTML="";break}let r=o[0];x.innerHTML=r;break}}});
